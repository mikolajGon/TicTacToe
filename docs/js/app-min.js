"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Board=function(){function e(){_classCallCheck(this,e),this.rows=3,this.columns=3,this.fields=this.createFields()}return _createClass(e,[{key:"createFields",value:function(){for(var e=[],t=0;t<this.columns;t++){for(var r=[],a=0;a<this.rows;a++){var i=new Field(t,a);r=_toConsumableArray(r).concat([i])}e=_toConsumableArray(e).concat([r])}return e}},{key:"renderFields",value:function(e){var r=document.createDocumentFragment();this.fields.forEach(function(e){e.forEach(function(e){var t=document.createElement("div");t.dataset.field="",t.dataset.x=e.x,t.dataset.y=e.y,t.classList.add("field"),r.appendChild(t)})}),e.appendChild(r)}},{key:"freeFields",get:function(){var t=[];return this.fields.forEach(function(e){return t=_toConsumableArray(t).concat(_toConsumableArray(e))}),t.filter(function(e){return e.free})}}]),e}(),Field=function(){function r(e,t){_classCallCheck(this,r),this.x=e,this.y=t,this.owner={},this.free=!0}return _createClass(r,[{key:"renderSymbol",value:function(e){var t=document.createElement("div"),r="cross"===this.owner.symbol?"cross":"circle";t.classList.add(r),e.appendChild(t)}}]),r}(),Game=function(){function t(e){_classCallCheck(this,t),this.board=[],this.players=[],this.ready=!1,this.fieldsLeft=0,this.config=e}return _createClass(t,[{key:"createPlayers",value:function(){this.players=this.config.getPlayers}},{key:"newBoard",value:function(e){this.board=e}},{key:"switchPlayers",value:function(){this.players.forEach(function(e){return e.active=!e.active})}},{key:"startNewGame",value:function(){this.createPlayers(),this.startGame(this.config.boardDiv)}},{key:"startGame",value:function(){this.newBoard(new Board),this.board.renderFields(this.config.boardDiv),this.fieldsLeft=9,this.ready=!0,displayMessage("".concat(this.activePlayer.name," turn")),this.activePlayer.isComputer&&this.computerMove()}},{key:"makeMove",value:function(e,t){displayMessage("".concat(this.unactivePlayer.name," turn")),this.ready=!1;var r=document.querySelector('[data-x="'.concat(e,'"][data-y="').concat(t,'"]')),a=this.board.fields[e][t];a.free=!1,a.owner=this.activePlayer,a.renderSymbol(r),this.fieldsLeft-=1,this.checkForWin(this.board,this.activePlayer)?(this.activePlayer.score+=1,displayMessage("".concat(this.activePlayer.name," has won!")),config.renderScores(),this.switchPlayers(),beginning.classList.remove("invisible")):0===this.fieldsLeft?(displayMessage("Draw"),config.renderScores(),this.switchPlayers(),beginning.classList.remove("invisible")):(this.switchPlayers(),this.activePlayer.isComputer&&this.computerMove(),this.ready=!0)}},{key:"handleInteraction",value:function(e){if(this.ready){var t=e.target.dataset,r=t.x,a=t.y;this.board.fields[r][a].free&&this.makeMove(r,a)}}},{key:"checkForWin",value:function(e,t){var r=function(e,t,r,a){return e.fields[t][r].owner===a};if(r(e,0,0,t)&&r(e,0,1,t)&&r(e,0,2,t)||r(e,1,0,t)&&r(e,1,1,t)&&r(e,1,2,t)||r(e,2,0,t)&&r(e,2,1,t)&&r(e,2,2,t)||r(e,0,0,t)&&r(e,1,0,t)&&r(e,2,0,t)||r(e,0,1,t)&&r(e,1,1,t)&&r(e,2,1,t)||r(e,0,2,t)&&r(e,1,2,t)&&r(e,2,2,t)||r(e,0,0,t)&&r(e,1,1,t)&&r(e,2,2,t)||r(e,0,2,t)&&r(e,1,1,t)&&r(e,2,0,t))return!0}},{key:"computerMove",value:function(){var f=this,v=this.activePlayer,h=this.unactivePlayer,e=function e(t,r){if(f.checkForWin(f.board,v))return 10-t;if(f.checkForWin(f.board,h))return t-10;if(f.fieldsLeft-t==0)return 0;var a=[],i=!0,n=!1,s=void 0;try{for(var o,c=f.board.freeFields[Symbol.iterator]();!(i=(o=c.next()).done);i=!0){var l=o.value;l.owner=r,l.free=!1;var u=e(t+1,r===h?v:h);a=_toConsumableArray(a).concat([Object.assign({},{x:l.x,y:l.y,value:u})]),l.owner={},l.free=!0}}catch(e){n=!0,s=e}finally{try{i||null==c.return||c.return()}finally{if(n)throw s}}if(r===h){var y=a.sort(function(e,t){return e.value<t.value?-1:1});return 0===t?y.shift():y.shift().value}if(r===v){var d=a.sort(function(e,t){return e.value<t.value?1:-1});return 0===t?d.shift():d.shift().value}}(0,v);this.makeMove(e.x,e.y)}},{key:"activePlayer",get:function(){return this.players.find(function(e){return e.active})}},{key:"unactivePlayer",get:function(){return this.players.find(function(e){return!e.active})}}]),t}(),Player=function e(t){var r=t.name,a=t.symbol,i=t.active,n=void 0!==i&&i,s=t.isComputer,o=void 0!==s&&s;_classCallCheck(this,e),this.name=r,this.symbol=a,this.active=n,this.isComputer=o,this.score=0},Config=function(){function t(e){_classCallCheck(this,t),this.vsComputer=!0,this.players=this.createNewPlayers(),this.boardDiv=e}return _createClass(t,[{key:"createNewPlayers",value:function(){return[new Player({name:"Player 1",symbol:"cross",active:!0}),new Player({name:"Player 2",symbol:"circle"}),new Player({name:"Computer",symbol:"circle",isComputer:!0})]}},{key:"newSymbol",value:function(e){e!==this.players[0].symbol&&this.players.forEach(function(e){e.symbol="circle"===e.symbol?"cross":"circle"})}},{key:"changeStartingPlayer",value:function(e){this.players[0].active=e,this.players[1].active=!e,this.players[2].active=!e}},{key:"newName",value:function(e){var t=e.player,r=e.name;"Player 1"===t?this.players[0].name=r:this.players[1].name=r}},{key:"renderScores",value:function(){var e=this.getPlayers[0],t=this.getPlayers[1];document.querySelector("#player1_name").textContent=e.name,document.querySelector("#player1_score").textContent=e.score,document.querySelector("#player2_name").textContent=t.name,document.querySelector("#player2_score").textContent=t.score}},{key:"resetScores",value:function(){this.players.forEach(function(e){return e.score=0})}},{key:"getPlayers",get:function(){var e=this.players;return this.vsComputer?[e[0],e[2]]:[e[0],e[1]]}}]),t}(),boardDiv=document.querySelector("#board"),startNewGame=document.querySelector("#start_new"),beginning=document.querySelector("#beginning"),options=document.querySelector("#options"),vsPlayer=document.querySelector("#vs_player"),vsComputer=document.querySelector("#vs_computer"),player2=document.querySelector("#player2_input"),optionsParams=document.querySelector("#options_params"),start=document.querySelector("#start"),restart=document.querySelector("#restart"),message=document.querySelector("#message"),messageContainer=document.querySelector("#message_container"),isStarting=document.querySelector("#is_starting"),inputs=document.querySelectorAll("input"),config=new Config(boardDiv),game=new Game(config),readyForStart=!0;function clearBoard(){for(;boardDiv.firstChild;)boardDiv.removeChild(boardDiv.firstChild)}function addListenersToBoardFields(){document.querySelectorAll("[data-field]").forEach(function(e){e.addEventListener("click",function(e){game.handleInteraction(e)})})}function getPlayerName(e){var t=e.dataset.player,r=e.value;console.log(r),readyForStart=r.length<4?(displayMessage("Please enter ".concat(t," name")),!1):(config.newName({player:t,name:r}),!0)}function displayMessage(e){message.textContent=e,messageContainer.classList.remove("invisible")}function changeSymbols(e){var t=e.dataset.symbol;config.newSymbol(t)}inputs.forEach(function(t){t.addEventListener("change",function(e){t.dataset.player&&getPlayerName(e.target),t.dataset.symbol&&changeSymbols(e.target)})}),vsPlayer.addEventListener("click",function(){config.vsComputer=!1,vsComputer.classList.remove("active"),vsPlayer.classList.toggle("active"),optionsParams.classList.remove("invisible"),player2.classList.remove("invisible")}),vsComputer.addEventListener("click",function(){config.vsComputer=!0,vsComputer.classList.toggle("active"),vsPlayer.classList.remove("active"),optionsParams.classList.remove("invisible"),player2.classList.add("invisible")}),startNewGame.addEventListener("click",function(){clearBoard(),config.resetScores(),beginning.classList.add("invisible"),restart.classList.remove("invisible"),options.classList.remove("invisible")}),start.addEventListener("click",function(e){readyForStart&&(clearBoard(),config.changeStartingPlayer(isStarting.checked),game.startNewGame(),config.renderScores(),addListenersToBoardFields(),options.classList.add("invisible"))}),restart.addEventListener("click",function(){clearBoard(),game.startGame(),addListenersToBoardFields(),beginning.classList.add("invisible")});